<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />



    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">





    <link rel="stylesheet" href="/css/footer.css">
    <link rel="stylesheet" href="/css/nav.css">
    <link rel="stylesheet" href="/css/showAll.css">
    <link rel="stylesheet" href="/css/searchBar.css">
    <link rel="stylesheet" href="/css/mainSearch.css">
    <link rel="stylesheet" href="/css/filterSearch.css">
    <link rel="stylesheet" href="/css/pagination.css">
    <link rel="stylesheet" href="/css/account.css">
    <link rel="stylesheet" href="/css/adminPerks.css">
    <title>Document</title>
</head>

<body>

    <nav>
        <div class="logo">
            <h4><b>TRAVELER</b></h4>
        </div>
        <div class="home">
            <a href="/">ALL TRIPS</a>
        </div>
    </nav>
    <hr>


    <main>

        <h1>give operater access</h1>
        <button><a href="/admin/grantagentaccess">operater access</a></button>

        <h1>send tokens</h1>
        <button><a href="/admin/sendCoins">tokens</a></button>



        <div class="cards-container">
            <% pendingTrips.forEach(trip=> { %>
                <div class="card-container">
                    <div class="card-img">
                        <% if (trip.tripImages && trip.tripImages.length> 0 && trip.tripImages[0].path) { %>
                            <div class="trip-image">
                                <img src="<%= trip.tripImages[0].path %>" alt="Trip Image">
                            </div>
                            <% } else { %>
                                <p>No images available for this trip</p>
                                <% } %>
                    </div>
                    <div class="card-body">
                        <div class="route">
                            <img src="../images/route.svg" alt="">
                            <h3 class="card-title">
                                <a href="/tour/<%= trip._id %>">
                                    <%= trip.location %>
                                </a>
                                <p>
                                    <% if (trip.departure) { %>
                                        <%= new Date(trip.departure).toLocaleDateString('en-US', { month: 'long' ,
                                            day: '2-digit' }) %> ~
                                            <% } else { %>
                                                Date not available
                                                <% } %>
                                                    <% if (trip.endDate) { %>
                                                        <%= new Date(trip.endDate).toLocaleDateString('en-US', {
                                                            month: 'long' , day: '2-digit' }) %>
                                                            <% } %>
                                </p>
                            </h3>
                        </div>
                        <div class="title-container">
                            <h4 class="trip-title">
                                <%= trip.title %>
                            </h4>
                        </div>

                        <div class="ratio-container">
                            <p class="maleRatio">Male: <%= trip.maleRatio %>%</p>
                            <p class="femaleRatio">Female: <%= trip.femaleRatio %>%</p>
                        </div>

                        <div class="rating-container">
                            <div class="rate rat1">
                                <!-- 5 Stars -->
                                <input type="radio" id="locStar5-<%= trip._id %>" name="locationRating-<%= trip._id %>"
                                    value="5" <%=trip.averageRating>= 5 ? 'checked' : '' %> disabled />
                                <label for="locStar5-<%= trip._id %>">5 stars</label>

                                <!-- 4 Stars -->
                                <input type="radio" id="locStar4-<%= trip._id %>" name="locationRating-<%= trip._id %>"
                                    value="4" <%=trip.averageRating>= 4 && trip.averageRating < 5 ? 'checked' : '' %>
                                    disabled />
                                    <label for="locStar4-<%= trip._id %>">4 stars</label>

                                    <!-- 3 Stars -->
                                    <input type="radio" id="locStar3-<%= trip._id %>"
                                        name="locationRating-<%= trip._id %>" value="3" <%=trip.averageRating>= 3 &&
                                    trip.averageRating < 4 ? 'checked' : '' %> disabled />
                                        <label for="locStar3-<%= trip._id %>">3 stars</label>

                                        <!-- 2 Stars -->
                                        <input type="radio" id="locStar2-<%= trip._id %>"
                                            name="locationRating-<%= trip._id %>" value="2" <%=trip.averageRating>= 2 &&
                                        trip.averageRating < 3 ? 'checked' : '' %> disabled />
                                            <label for="locStar2-<%= trip._id %>">2 stars</label>

                                            <!-- 1 Star -->
                                            <input type="radio" id="locStar1-<%= trip._id %>"
                                                name="locationRating-<%= trip._id %>" value="1" <%=trip.averageRating>=
                                            1 && trip.averageRating < 2 ? 'checked' : '' %> disabled />
                                                <label for="locStar1-<%= trip._id %>">1 star</label>
                            </div>
                            <p>
                                <%= trip.averageRating %>
                            </p>
                        </div>

                        <div class="card-bottom">
                            <div class="days-container">
                                <h4 class="days">
                                    <%= trip.totalDays %> days
                                </h4>
                            </div>
                            <div class="price-container">
                                <% if (trip.totalCost) { %>
                                    <span>FROM</span> &nbsp;<b>
                                        <%= trip.totalCost.toLocaleString('en-IN', { style: 'currency' , currency: 'INR'
                                            }) %>
                                    </b>
                                    <% } else { %>
                                        Price Not Available
                                        <% } %>
                            </div>
                        </div>


                    </div>
                    <!-- Accept and Reject Buttons -->
                    <div class="action-buttons">
                        <form action="/admin/<%= trip._id %>/update-status" method="POST">
                            <button type="submit" name="action" value="accept" class="acceptTrip">Accept</button>
                        </form>
                        <button type="button" class="rejectTrip"
                            onclick="showRejectionReason('<%= trip._id %>')">Reject</button>

                        <div id="reason-<%= trip._id %>" style="display:none;">
                            <form action="/admin/<%= trip._id %>/update-status" method="POST">
                                <textarea name="rejectionReason" placeholder="Enter rejection reason"></textarea>
                                <button type="submit" name="action" value="reject">Submit</button>
                            </form>
                        </div>
                    </div>
                </div>
                <% }) %>
        </div>

    </main>

    <script>
        // Function to toggle the visibility of the rejection reason textarea
        function showRejectionReason(tripId) {
            const reasonDiv = document.getElementById(`reason-${tripId}`);
            reasonDiv.style.display = reasonDiv.style.display === "none" ? "block" : "none";
        }










        // Optionally, use JavaScript to trigger form submission and refresh the page automatically
        const acceptForms = document.querySelectorAll('form[id^="accept-form-"]');
        acceptForms.forEach(form => {
            form.addEventListener('submit', () => {
                window.location.reload();  // Refresh page on submit
            });
        });

        const rejectForms = document.querySelectorAll('form[id^="reject-form-"]');
        rejectForms.forEach(form => {
            form.addEventListener('submit', () => {
                window.location.reload();  // Refresh page on submit
            });
        });





    </script>


</body>

</html>